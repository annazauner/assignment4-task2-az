---
title: 'Task 2: Mini "exploratory report" on juvenile snowshoe hares in Bonanza Creek'
author: "Anna Zauner"
date: "11/4/2021"
output: 
  html_document: 
    theme: cerulean
    toc: yes
---
# Introduction 

A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last so you know whatâ€™s contained in the report.
 
*Data citation*: Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

## Set up

```{r setup, include=TRUE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(janitor)
library(here)
library(lubridate)
library(kableExtra)
library(effsize)
```

## Read in the data

```{r}
bonanza_hares_data <- read_csv(here("data","bonanza_hares.csv")) %>% 
  clean_names() %>% 
  mutate(date = mdy(date))
```

# Data and anyalses

 A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.
 
# Juvenile hare initial investigation 

## Section 1: Annual juvenile hare trap counts

. Count the total number of juvenile hare trappings during each year of the study, and create a finalized data visualization of the counts by year. Include a figure caption below the figure in your report. 

```{r}
annual_juvenile_trap_counts <- bonanza_hares_data %>%
  filter(age == "j") %>% 
  mutate(year = year(date)) %>% 
  group_by(year) %>% 
  summarize(trap_counts = n())


ggplot(data = annual_juvenile_trap_counts, aes(x = year, y = trap_counts))+
  geom_bar(stat = "identity", fill = "blue")+
  labs(x = "Year",
       y = "Juvenile hare trap counts",
       title = "Annual juvenile hare trap counts (1998-2012)",
       caption = "Figure 1: Counts of juvenile hare trappings during each year of the study from 1998 to 2012")+
  theme_classic()+
  theme(plot.caption = element_text(hjust = 0.5, size = 8, face = "bold"),
        plot.title = element_text(hjust = 0.5, face = "bold"))+
  scale_x_continuous(breaks = c(1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012))


```

### Figure 1 takeaways

There is a general trend of decreasing counts of juvenile hare trappings from 1998-2012, there is a large spread of annual juvenile hare trap counts, ranging from 2 to 126. The mean count of juvenile hares trapped annually is 31.5 and median is 18.5. The changes from year to year show no consistent trend, this could be due to the fact that these are absolute counts and are impacted by the effort of researchers. I would suggest standardizing the juvenile hare population by randomly selecting uniform sample sizes for each year. 

```{r}
annual_counts_summary <- annual_juvenile_trap_counts %>% 
  summarize(mean = mean(trap_counts),
            median = median(trap_counts),
            minimum = min(trap_counts),
            maximum = max(trap_counts)) %>% 
  kable(caption = "Table 1: Summary statistics of annual juvenile hare trap counts",
        col.names = c("Mean",
                      "Median",
                      "Minimun",
                      "Maximum")) %>% 
  kable_minimal()
  
annual_counts_summary

```

## Section 2: Visualize juvenile hare weights

```{r}
# Wrangle the data 
juvenile_weights_sex_site <- bonanza_hares_data %>% 
  filter(age == "j") %>% 
  select(sex, weight, grid) %>% 
  mutate(sex = case_when(
    sex == "m" ~ "M",
    sex == "f" ~ "F")) %>% 
  mutate(grid_full = case_when(
    grid == "bonbs" ~ "Bonbs",
    grid == "bonmat" ~ "Bonanza Mature",
    grid == "bonrip" ~ "Bonanza Riparian"
  ))

# Histogram visualization 
ggplot(data = juvenile_weights_sex_site, aes(x = weight))+
  geom_histogram()+
  aes(fill = sex)+
  facet_grid(grid_full ~ sex)+
  labs(title = "Juvenile hare weights by sex and site",
       x = "Weight (g)",
       y = "Count",
       caption = "Figure 2: Juvenile hare weights in grams recorded by sex and site recorded.",
       fill = "Sex")+
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.caption = element_text(hjust = 0.5, face = "bold"),
        )


```


### Figure 2 takeaways

There is a correlation between the count of juvenile hare weight and site. The Bonanza Riparian site has the largest counts of weights for both male and female juvenile hares, and the Bonbs site has the fewest counts of weights for males, females and NA. The distribution of weights of juvenile hares between sites and sexes have no clear differences, the biggest take away is the differences in counts and how that is impacting the lack of visible trends.

```{r}
# Summary statistics

juvenile_weights_sex_site_summary <- juvenile_weights_sex_site %>% 
  group_by(grid_full, sex) %>% 
  summarize(sample_size = n(),
            meadian = median(weight, na.rm = TRUE),
            mean = mean(weight, na.rm = TRUE),
            min = min(weight, na.rm = TRUE),
            max = max(weight, na.rm = TRUE),
            sd = sd(weight, na.rm = TRUE)) %>% 
  kbl(caption = "Table 2: Summary statistics for male, female and NA juvenile hare weights (g)",
      col.names = c("Site",
                    "Sex",
                    "Sample size",
                    "Median (g)",
                    "Mean (g)",
                    "Min (g)",
                    "Max (g)",
                    "Standard deviation (g)")) %>% 
  kable_minimal(html_font = "Georgia", font_size = 12, full_width = FALSE) %>% 
  kable_material(c("striped", "hover", "condensed"))
  
juvenile_weights_sex_site_summary

```

### Table 2 takeaways 

The summary statistics of juvenile hare weights by site and sex indicate a large differences in sample sizes betweeen each site. Mean female weights tend to be lower than male weights between all sites. Overall there is a high variation in weights between males and females. 

## Section 3: Juvenile weight comparison (male & female snowshoe hares)

```{r}
# Wrangle the data 
juvenile_m_f_weight <- bonanza_hares_data %>%
  filter(age == "j", 
         sex %in% c("m", "f")) %>% 
  select(sex, weight) %>% 
    mutate(sex = case_when(
    sex == "m" ~ "Male",
    sex == "f" ~ "Female"))
 
# Table 

juvenile_m_f_weight_summary <- juvenile_m_f_weight %>% 
  group_by(sex) %>% 
  summarize(mean = mean(weight, na.rm = TRUE),
            median = median(weight, na.rm = TRUE),
            sd = sd(weight, na.rm = TRUE),
            sample_size = n()) %>% 
  kable(caption = "Table 3: Summary statistics of juvenile weights (g) between male and femal snowshoe hares",
        col.names = c("Sex",
                      "Mean (g)",
                      "Median (g)",
                      "Standard deviation (g)",
                      "Sample size"),
        digits = 1) %>% 
  kable_minimal(html_font = "Georgia", font_size = 12, full_width = FALSE) %>% 
  kable_material(c("striped", "hover", "condensed"))
  
juvenile_m_f_weight_summary
```

```{r, include=FALSE}

# Exploratory graphs 

ggplot(data =juvenile_m_f_weight, aes(x = weight))+
  geom_histogram()+
  facet_wrap(~sex)

ggplot(data =juvenile_m_f_weight, aes(sample = weight))+
  geom_qq()+
  facet_wrap(~sex)
 
# Sample size in combination with histograms & QQ plots: I feel OK about using a t-test for a means comparison.         
```


```{r}

# Two sample t-test and Cohen test set up

male_sample <- juvenile_m_f_weight %>% 
  filter(sex == "Male") %>% 
  drop_na(weight) %>% 
  pull(weight)


female_sample <- juvenile_m_f_weight %>% 
  filter(sex == "Female") %>% 
  drop_na(weight) %>% 
  pull(weight)
  


# Two sample t-test
m_f_weight_t <- t.test(male_sample,female_sample)

m_f_weight_t # p = 0.7%

# Cohen test

m_f_weiht_cohen <- cohen.d(male_sample, female_sample)

m_f_weiht_cohen
```

### Table 3 takeaways

The difference in mean weight between male and female juvenile hares is 90.5 (g), and the results of the t-test have a p-value of `r m_f_weight_t$p.value` meaning that if these samples were drawn from populations with the same mean, the probability of taking two random samples with means at least as different as the sample means we found by random chance (taking into account Cohen's d = 0.29 and n = 363) is a 0.7%. Therefore we can reject the null hypothesis that the samples were drawn from populations with the same mean.

## Section 4: Relationship between juvenile weight & hind foot length

```{r}
# Wrangle the data

juvenile_hfoot <- bonanza_hares_data %>% 
  filter(age == "j") %>% 
  select(weight, hindft)

# Data visualization

ggplot(data = juvenile_hfoot, aes(x = hindft, y = weight))+
  geom_jitter()+
  geom_smooth(method = "lm")+
  labs(x = "Hindfoot length (mm)",
       y = "Weight (g)",
       title = "Juvenile hare weight and hindfoot length",
       caption = "Figure 3: Juvenile hare weight (g) and hindfoot length (mm) comparison with regression line")+
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.caption = element_text(hjust = 0.5, face = "bold"))
```
```{r}
# Linear model stored as juvenile_lm 
juvenile_lm <- lm(weight ~ hindft, data = juvenile_hfoot)

# Return complere overview

summary(juvenile_lm)

# Use broom::tidy() function to see the model outputs in a nice format

juvenile_lm_tidy <- broom::tidy(juvenile_lm)

juvenile_lm_tidy_out <- broom::glance(juvenile_lm_tidy)
juvenile_lm_tidy_out

# Find Pearson's r value which indicated the strength of the correlation between hindfoot length and weight. 

juvenile_cor <- cor.test(juvenile_hfoot$weight, juvenile_hfoot$hindft)
```

# Summary 

# Citations 

*Data citation*: Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

